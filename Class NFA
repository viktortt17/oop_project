import java.io.Serializable;
import java.util.*;

public class NFA implements Serializable {
    private Set<String> states;
    private Set<String> alphabet;
    private Set<Transition> transitions;
    private String startState;
    private Set<String> acceptStates;

    public NFA(Set<String> states, Set<String> alphabet, Set<Transition> transitions, String startState, Set<String> acceptStates) {
        this.states = states;
        this.alphabet = alphabet;
        this.transitions = transitions;
        this.startState = startState;
        this.acceptStates = acceptStates;
    }

    public Set<String> getStates() {
        return states;
    }

    public Set<String> getAlphabet() {
        return alphabet;
    }

    public Set<Transition> getTransitions() {
        return transitions;
    }

    public String getStartState() {
        return startState;
    }

    public Set<String> getAcceptStates() {
        return acceptStates;
    }

    public boolean isDeterministic() {
        Map<String, Set<String>> transitionMap = new HashMap<>();

        for (Transition t : transitions) {
            if (t.getSymbol().equals("Îµ")) {
                return false;
            }

            String key = t.getFromState() + "," + t.getSymbol();
            transitionMap.putIfAbsent(key, new HashSet<>());
            transitionMap.get(key).add(t.getToState());

            if (transitionMap.get(key).size() > 1) {
                return false;
            }
        }
        return true;
    }

    public boolean isLanguageEmpty() {
        if (startState == null || acceptStates.isEmpty()) {
            return true;
        }

        Set<String> visited = new HashSet<>();
        Stack<String> stack = new Stack<>();
        stack.push(startState);

        while (!stack.isEmpty()) {
            String state = stack.pop();
            if (visited.contains(state)) continue;
            visited.add(state);

            if (acceptStates.contains(state)) {
                return false;
            }

            for (Transition t : transitions) {
                if (t.getFromState().equals(state)) {
                    stack.push(t.getToState());
                }
            }
        }
        return true;
    }

    @Override
    public String toString() {
        return "NFA{" +
                "states=" + states +
                ", alphabet=" + alphabet +
                ", transitions=" + transitions +
                ", startState='" + startState + '\'' +
                ", acceptStates=" + acceptStates +
                '}';
    }
}
